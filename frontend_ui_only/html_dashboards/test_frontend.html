<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Frontend Testing</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #007acc;
            background: #f9f9f9;
        }
        .test-result {
            margin: 5px 0;
            padding: 8px;
            border-radius: 4px;
        }
        .test-pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .dashboard-frame {
            width: 100%;
            height: 800px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 20px 0;
        }
        .test-controls {
            margin: 10px 0;
        }
        .test-btn {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-btn:hover {
            background: #005999;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-pass { background: #28a745; }
        .status-fail { background: #dc3545; }
        .status-pending { background: #ffc107; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Dashboard Frontend Testing Suite</h1>
        
        <div class="test-section">
            <h2>Test Configuration</h2>
            <div class="test-controls">
                <button class="test-btn" onclick="runAllTests()">Run All Tests</button>
                <button class="test-btn" onclick="testTabSwitching()">Test Tab Switching</button>
                <button class="test-btn" onclick="testPerformanceCharts()">Test Performance Charts</button>
                <button class="test-btn" onclick="testLLMToggle()">Test LLM Toggle</button>
                <button class="test-btn" onclick="clearResults()">Clear Results</button>
            </div>
        </div>

        <div class="test-section">
            <h2>üìä Test Results</h2>
            <div id="test-results">
                <div class="test-info">Click "Run All Tests" to begin frontend testing</div>
            </div>
        </div>

        <div class="test-section">
            <h2>üñ•Ô∏è Dashboard Preview</h2>
            <iframe id="dashboard-frame" class="dashboard-frame" src="http://localhost:5000" 
                    onload="onDashboardLoad()"></iframe>
        </div>
    </div>

    <script>
        let testResults = [];
        let dashboardFrame = null;

        function onDashboardLoad() {
            dashboardFrame = document.getElementById('dashboard-frame');
            addTestResult('info', 'Dashboard loaded successfully');
            
            try {
                // Try to access iframe content (may be blocked by CORS)
                const iframeDoc = dashboardFrame.contentDocument || dashboardFrame.contentWindow.document;
                if (iframeDoc) {
                    addTestResult('pass', 'Dashboard iframe accessible');
                } else {
                    addTestResult('info', 'Dashboard iframe loaded (CORS restrictions may apply)');
                }
            } catch (e) {
                addTestResult('info', 'Dashboard loaded with CORS restrictions (expected)');
            }
        }

        function addTestResult(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const result = {
                type: type,
                message: message,
                timestamp: timestamp
            };
            testResults.push(result);
            updateTestDisplay();
        }

        function updateTestDisplay() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '';
            
            let passCount = 0;
            let failCount = 0;
            let infoCount = 0;

            testResults.forEach(result => {
                const div = document.createElement('div');
                div.className = `test-result test-${result.type}`;
                
                let statusClass = 'status-pending';
                if (result.type === 'pass') {
                    statusClass = 'status-pass';
                    passCount++;
                } else if (result.type === 'fail') {
                    statusClass = 'status-fail';
                    failCount++;
                } else {
                    infoCount++;
                }
                
                div.innerHTML = `
                    <span class="status-indicator ${statusClass}"></span>
                    <strong>[${result.timestamp}]</strong> ${result.message}
                `;
                resultsDiv.appendChild(div);
            });

            // Add summary
            if (testResults.length > 1) {
                const summaryDiv = document.createElement('div');
                summaryDiv.className = 'test-result test-info';
                summaryDiv.innerHTML = `
                    <strong>Test Summary:</strong> 
                    ${passCount} passed, ${failCount} failed, ${infoCount} info
                `;
                resultsDiv.insertBefore(summaryDiv, resultsDiv.firstChild);
            }
        }

        async function runAllTests() {
            clearResults();
            addTestResult('info', 'Starting comprehensive frontend tests...');
            
            await testDashboardAccess();
            await testAPIConnectivity();
            await testTabSwitching();
            await testPerformanceCharts();
            await testLLMToggle();
            
            addTestResult('info', 'All frontend tests completed');
        }

        async function testDashboardAccess() {
            addTestResult('info', 'Testing dashboard accessibility...');
            
            try {
                const response = await fetch('http://localhost:5000');
                if (response.ok) {
                    const content = await response.text();
                    if (content.includes('TestMaster Dashboard')) {
                        addTestResult('pass', 'Dashboard HTML contains expected title');
                    } else {
                        addTestResult('fail', 'Dashboard HTML missing expected content');
                    }
                    
                    if (content.includes('tab-button')) {
                        addTestResult('pass', 'Tab system HTML structure present');
                    } else {
                        addTestResult('fail', 'Tab system HTML structure missing');
                    }
                    
                    if (content.includes('llm-toggle-btn')) {
                        addTestResult('pass', 'LLM toggle button HTML present');
                    } else {
                        addTestResult('fail', 'LLM toggle button HTML missing');
                    }
                } else {
                    addTestResult('fail', `Dashboard not accessible: HTTP ${response.status}`);
                }
            } catch (error) {
                addTestResult('fail', `Dashboard access error: ${error.message}`);
            }
        }

        async function testAPIConnectivity() {
            addTestResult('info', 'Testing critical API endpoints...');
            
            const criticalEndpoints = [
                { path: '/api/health', name: 'Health Check' },
                { path: '/api/performance/realtime', name: 'Real-time Performance' },
                { path: '/api/workflow/status', name: 'Workflow Status' },
                { path: '/api/llm/status', name: 'LLM Status' }
            ];

            for (const endpoint of criticalEndpoints) {
                try {
                    const response = await fetch(`http://localhost:5000${endpoint.path}`);
                    if (response.ok) {
                        addTestResult('pass', `${endpoint.name} API accessible`);
                    } else {
                        addTestResult('fail', `${endpoint.name} API failed: HTTP ${response.status}`);
                    }
                } catch (error) {
                    addTestResult('fail', `${endpoint.name} API error: ${error.message}`);
                }
            }
        }

        async function testTabSwitching() {
            addTestResult('info', 'Testing tab switching functionality...');
            
            const expectedTabs = ['overview', 'analytics', 'tests', 'workflow', 'refactor', 'analyzer'];
            
            try {
                const response = await fetch('http://localhost:5000');
                if (response.ok) {
                    const html = await response.text();
                    
                    let foundTabs = 0;
                    expectedTabs.forEach(tab => {
                        if (html.includes(`data-tab="${tab}"`)) {
                            foundTabs++;
                        }
                    });
                    
                    if (foundTabs === expectedTabs.length) {
                        addTestResult('pass', `All ${expectedTabs.length} tabs found in HTML`);
                    } else {
                        addTestResult('fail', `Only ${foundTabs}/${expectedTabs.length} tabs found`);
                    }
                    
                    // Check for tab content divs
                    let foundContent = 0;
                    expectedTabs.forEach(tab => {
                        if (html.includes(`id="${tab}-tab"`)) {
                            foundContent++;
                        }
                    });
                    
                    if (foundContent >= 2) { // At least overview and analytics should exist
                        addTestResult('pass', `Tab content sections found (${foundContent})`);
                    } else {
                        addTestResult('fail', `Insufficient tab content sections (${foundContent})`);
                    }
                }
            } catch (error) {
                addTestResult('fail', `Tab switching test error: ${error.message}`);
            }
        }

        async function testPerformanceCharts() {
            addTestResult('info', 'Testing performance charts configuration...');
            
            try {
                const response = await fetch('http://localhost:5000');
                if (response.ok) {
                    const html = await response.text();
                    
                    // Check for chart canvases
                    const chartIds = ['analytics-cpu-chart', 'analytics-memory-chart', 'analytics-network-chart'];
                    let foundCharts = 0;
                    
                    chartIds.forEach(chartId => {
                        if (html.includes(`id="${chartId}"`)) {
                            foundCharts++;
                        }
                    });
                    
                    if (foundCharts === 3) {
                        addTestResult('pass', 'All 3 performance chart canvases found');
                    } else {
                        addTestResult('fail', `Only ${foundCharts}/3 chart canvases found`);
                    }
                    
                    // Check for Chart.js library
                    if (html.includes('chart.js')) {
                        addTestResult('pass', 'Chart.js library referenced');
                    } else {
                        addTestResult('fail', 'Chart.js library not found');
                    }
                }
                
                // Test real-time data endpoint
                const perfResponse = await fetch('http://localhost:5000/api/performance/realtime');
                if (perfResponse.ok) {
                    const data = await perfResponse.json();
                    if (data.timeseries && data.timeseries.cpu_usage) {
                        const dataPoints = data.timeseries.cpu_usage.length;
                        if (dataPoints === 300) {
                            addTestResult('pass', `Performance data: exactly 300 points (30s @ 100ms)`);
                        } else {
                            addTestResult('info', `Performance data: ${dataPoints} points`);
                        }
                    } else {
                        addTestResult('fail', 'Performance data structure incorrect');
                    }
                } else {
                    addTestResult('fail', 'Performance data endpoint not accessible');
                }
                
            } catch (error) {
                addTestResult('fail', `Performance charts test error: ${error.message}`);
            }
        }

        async function testLLMToggle() {
            addTestResult('info', 'Testing LLM toggle functionality...');
            
            try {
                // Test LLM status endpoint
                const statusResponse = await fetch('http://localhost:5000/api/llm/status');
                if (statusResponse.ok) {
                    const status = await statusResponse.json();
                    addTestResult('pass', `LLM status: ${status.api_enabled ? 'enabled' : 'disabled'}`);
                    
                    // Test toggle functionality
                    const toggleResponse = await fetch('http://localhost:5000/api/llm/toggle-mode', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ enabled: !status.api_enabled })
                    });
                    
                    if (toggleResponse.ok) {
                        const toggleResult = await toggleResponse.json();
                        addTestResult('pass', 'LLM toggle endpoint functional');
                    } else {
                        addTestResult('fail', `LLM toggle failed: HTTP ${toggleResponse.status}`);
                    }
                } else {
                    addTestResult('fail', `LLM status endpoint failed: HTTP ${statusResponse.status}`);
                }
                
                // Check HTML for toggle button
                const htmlResponse = await fetch('http://localhost:5000');
                if (htmlResponse.ok) {
                    const html = await htmlResponse.text();
                    if (html.includes('llm-toggle-btn')) {
                        addTestResult('pass', 'LLM toggle button found in HTML');
                    } else {
                        addTestResult('fail', 'LLM toggle button not found in HTML');
                    }
                }
                
            } catch (error) {
                addTestResult('fail', `LLM toggle test error: ${error.message}`);
            }
        }

        function clearResults() {
            testResults = [];
            updateTestDisplay();
        }

        // Auto-run basic tests when page loads
        window.onload = function() {
            setTimeout(() => {
                addTestResult('info', 'Frontend testing suite loaded');
                addTestResult('info', 'Ready to test dashboard functionality');
            }, 1000);
        };
    </script>
</body>
</html>