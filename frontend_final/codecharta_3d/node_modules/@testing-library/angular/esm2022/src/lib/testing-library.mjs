import { ChangeDetectorRef, Component, NgZone, SimpleChange, ApplicationInitStatus, isStandalone, } from '@angular/core';
import { TestBed, tick } from '@angular/core/testing';
import { BrowserAnimationsModule, NoopAnimationsModule } from '@angular/platform-browser/animations';
import { Router } from '@angular/router';
import { RouterTestingModule } from '@angular/router/testing';
import { getQueriesForElement as dtlGetQueriesForElement, prettyDOM as dtlPrettyDOM, waitFor as dtlWaitFor, waitForElementToBeRemoved as dtlWaitForElementToBeRemoved, screen as dtlScreen, within as dtlWithin, configure as dtlConfigure, } from '@testing-library/dom';
import { getConfig } from './config';
import * as i0 from "@angular/core";
const mountedFixtures = new Set();
const safeInject = TestBed.inject || TestBed.get;
export async function render(sut, renderOptions = {}) {
    const { dom: domConfig, ...globalConfig } = getConfig();
    const { detectChangesOnRender = true, autoDetectChanges = true, declarations = [], imports = [], providers = [], schemas = [], queries, wrapper = WrapperComponent, componentProperties = {}, componentInputs = {}, componentOutputs = {}, componentProviders = [], childComponentOverrides = [], componentImports: componentImports, excludeComponentDeclaration = false, routes = [], removeAngularAttributes = false, defaultImports = [], initialRoute = '', configureTestBed = () => {
        /* noop*/
    }, } = { ...globalConfig, ...renderOptions };
    dtlConfigure({
        eventWrapper: (cb) => {
            const result = cb();
            if (autoDetectChanges) {
                detectChangesForMountedFixtures();
            }
            return result;
        },
        ...domConfig,
    });
    TestBed.configureTestingModule({
        declarations: addAutoDeclarations(sut, {
            declarations,
            excludeComponentDeclaration,
            wrapper,
        }),
        imports: addAutoImports(sut, {
            imports: imports.concat(defaultImports),
            routes,
        }),
        providers: [...providers],
        schemas: [...schemas],
    });
    overrideComponentImports(sut, componentImports);
    overrideChildComponentProviders(childComponentOverrides);
    configureTestBed(TestBed);
    await TestBed.compileComponents();
    componentProviders
        .reduce((acc, provider) => acc.concat(provider), [])
        .forEach((p) => {
        const { provide, ...provider } = p;
        TestBed.overrideProvider(provide, provider);
    });
    const componentContainer = createComponentFixture(sut, wrapper);
    const zone = safeInject(NgZone);
    const router = safeInject(Router);
    const _navigate = async (elementOrPath, basePath = '') => {
        const href = typeof elementOrPath === 'string' ? elementOrPath : elementOrPath.getAttribute('href');
        const [path, params] = (basePath + href).split('?');
        const queryParams = params
            ? params.split('&').reduce((qp, q) => {
                const [key, value] = q.split('=');
                const currentValue = qp[key];
                if (typeof currentValue === 'undefined') {
                    qp[key] = value;
                }
                else if (Array.isArray(currentValue)) {
                    qp[key] = [...currentValue, value];
                }
                else {
                    qp[key] = [currentValue, value];
                }
                return qp;
            }, {})
            : undefined;
        const navigateOptions = queryParams
            ? {
                queryParams,
            }
            : undefined;
        const doNavigate = () => {
            return navigateOptions ? router?.navigate([path], navigateOptions) : router?.navigate([path]);
        };
        let result;
        if (zone) {
            await zone.run(() => (result = doNavigate()));
        }
        else {
            result = doNavigate();
        }
        return result ?? false;
    };
    if (initialRoute)
        await _navigate(initialRoute);
    if (typeof router?.initialNavigation === 'function') {
        if (zone) {
            zone.run(() => router.initialNavigation());
        }
        else {
            router.initialNavigation();
        }
    }
    let fixture;
    let detectChanges;
    await renderFixture(componentProperties, componentInputs, componentOutputs);
    let renderedPropKeys = Object.keys(componentProperties);
    let renderedInputKeys = Object.keys(componentInputs);
    let renderedOutputKeys = Object.keys(componentOutputs);
    const rerender = async (properties) => {
        const newComponentInputs = properties?.componentInputs ?? {};
        const changesInComponentInput = update(fixture, renderedInputKeys, newComponentInputs, setComponentInputs);
        renderedInputKeys = Object.keys(newComponentInputs);
        const newComponentOutputs = properties?.componentOutputs ?? {};
        for (const outputKey of renderedOutputKeys) {
            if (!Object.prototype.hasOwnProperty.call(newComponentOutputs, outputKey)) {
                delete fixture.componentInstance[outputKey];
            }
        }
        setComponentOutputs(fixture, newComponentOutputs);
        renderedOutputKeys = Object.keys(newComponentOutputs);
        const newComponentProps = properties?.componentProperties ?? {};
        const changesInComponentProps = update(fixture, renderedPropKeys, newComponentProps, setComponentProperties);
        renderedPropKeys = Object.keys(newComponentProps);
        if (hasOnChangesHook(fixture.componentInstance)) {
            fixture.componentInstance.ngOnChanges({
                ...changesInComponentInput,
                ...changesInComponentProps,
            });
        }
        if (properties?.detectChangesOnRender !== false) {
            fixture.componentRef.injector.get(ChangeDetectorRef).detectChanges();
        }
    };
    const navigate = async (elementOrPath, basePath = '') => {
        const result = await _navigate(elementOrPath, basePath);
        detectChanges();
        return result;
    };
    return {
        // @ts-ignore: fixture assigned
        fixture,
        detectChanges: () => detectChanges(),
        navigate,
        rerender,
        // @ts-ignore: fixture assigned
        debugElement: fixture.debugElement,
        // @ts-ignore: fixture assigned
        container: fixture.nativeElement,
        debug: (element = fixture.nativeElement, maxLength, options) => Array.isArray(element)
            ? element.forEach((e) => console.log(dtlPrettyDOM(e, maxLength, options)))
            : console.log(dtlPrettyDOM(element, maxLength, options)),
        // @ts-ignore: fixture assigned
        ...replaceFindWithFindAndDetectChanges(dtlGetQueriesForElement(fixture.nativeElement, queries)),
    };
    async function renderFixture(properties, inputs, outputs) {
        if (fixture) {
            cleanupAtFixture(fixture);
        }
        fixture = await createComponent(componentContainer);
        setComponentProperties(fixture, properties);
        setComponentInputs(fixture, inputs);
        setComponentOutputs(fixture, outputs);
        if (removeAngularAttributes) {
            fixture.nativeElement.removeAttribute('ng-version');
            const idAttribute = fixture.nativeElement.getAttribute('id');
            if (idAttribute && idAttribute.startsWith('root')) {
                fixture.nativeElement.removeAttribute('id');
            }
        }
        mountedFixtures.add(fixture);
        let isAlive = true;
        fixture.componentRef.onDestroy(() => (isAlive = false));
        if (hasOnChangesHook(fixture.componentInstance) && Object.keys(properties).length > 0) {
            const changes = getChangesObj(null, componentProperties);
            fixture.componentInstance.ngOnChanges(changes);
        }
        detectChanges = () => {
            if (isAlive) {
                fixture.detectChanges();
            }
        };
        if (detectChangesOnRender) {
            detectChanges();
        }
    }
}
async function createComponent(component) {
    /* Make sure angular application is initialized before creating component */
    await safeInject(ApplicationInitStatus).donePromise;
    return TestBed.createComponent(component);
}
function createComponentFixture(sut, wrapper) {
    if (typeof sut === 'string') {
        TestBed.overrideTemplate(wrapper, sut);
        return wrapper;
    }
    return sut;
}
function setComponentProperties(fixture, componentProperties = {}) {
    for (const key of Object.keys(componentProperties)) {
        const descriptor = Object.getOwnPropertyDescriptor(fixture.componentInstance.constructor.prototype, key);
        let _value = componentProperties[key];
        const defaultGetter = () => _value;
        const extendedSetter = (value) => {
            _value = value;
            descriptor?.set?.call(fixture.componentInstance, _value);
            fixture.detectChanges();
        };
        Object.defineProperty(fixture.componentInstance, key, {
            get: descriptor?.get || defaultGetter,
            set: extendedSetter,
            // Allow the property to be defined again later.
            // This happens when the component properties are updated after initial render.
            // For Jest this is `true` by default, for Karma and a real browser the default is `false`
            configurable: true,
        });
        descriptor?.set?.call(fixture.componentInstance, _value);
    }
    return fixture;
}
function setComponentOutputs(fixture, componentOutputs = {}) {
    for (const [name, value] of Object.entries(componentOutputs)) {
        fixture.componentInstance[name] = value;
    }
}
function setComponentInputs(fixture, componentInputs = {}) {
    for (const [name, value] of Object.entries(componentInputs)) {
        fixture.componentRef.setInput(name, value);
    }
}
function overrideComponentImports(sut, imports) {
    if (imports) {
        if (typeof sut === 'function' && isStandalone(sut)) {
            TestBed.overrideComponent(sut, { set: { imports } });
        }
        else {
            throw new Error(`Error while rendering ${sut}: Cannot specify componentImports on a template or non-standalone component.`);
        }
    }
}
function overrideChildComponentProviders(componentOverrides) {
    componentOverrides?.forEach(({ component, providers }) => {
        TestBed.overrideComponent(component, { set: { providers } });
    });
}
function hasOnChangesHook(componentInstance) {
    return (componentInstance !== null &&
        typeof componentInstance === 'object' &&
        'ngOnChanges' in componentInstance &&
        typeof componentInstance.ngOnChanges === 'function');
}
function getChangesObj(oldProps, newProps) {
    const isFirstChange = oldProps === null;
    return Object.keys(newProps).reduce((changes, key) => ({
        ...changes,
        [key]: new SimpleChange(isFirstChange ? null : oldProps[key], newProps[key], isFirstChange),
    }), {});
}
function update(fixture, prevRenderedKeys, newValues, updateFunction) {
    const componentInstance = fixture.componentInstance;
    const simpleChanges = {};
    for (const key of prevRenderedKeys) {
        if (!Object.prototype.hasOwnProperty.call(newValues, key)) {
            simpleChanges[key] = new SimpleChange(componentInstance[key], undefined, false);
            delete componentInstance[key];
        }
    }
    for (const [key, value] of Object.entries(newValues)) {
        if (value !== componentInstance[key]) {
            simpleChanges[key] = new SimpleChange(componentInstance[key], value, false);
        }
    }
    updateFunction(fixture, newValues);
    return simpleChanges;
}
function addAutoDeclarations(sut, { declarations = [], excludeComponentDeclaration, wrapper, }) {
    if (typeof sut === 'string') {
        return [...declarations, wrapper];
    }
    const components = () => (excludeComponentDeclaration || isStandalone(sut) ? [] : [sut]);
    return [...declarations, ...components()];
}
function addAutoImports(sut, { imports = [], routes }) {
    const animations = () => {
        const animationIsDefined = imports.indexOf(NoopAnimationsModule) > -1 || imports.indexOf(BrowserAnimationsModule) > -1;
        return animationIsDefined ? [] : [NoopAnimationsModule];
    };
    const routing = () => (routes ? [RouterTestingModule.withRoutes(routes)] : []);
    const components = () => (typeof sut !== 'string' && isStandalone(sut) ? [sut] : []);
    return [...imports, ...components(), ...animations(), ...routing()];
}
/**
 * Wrap waitFor to invoke the Angular change detection cycle before invoking the callback
 */
async function waitForWrapper(detectChanges, callback, options) {
    let inFakeAsync = true;
    try {
        tick(0);
    }
    catch (err) {
        inFakeAsync = false;
    }
    return await dtlWaitFor(() => {
        setTimeout(() => detectChanges(), 0);
        if (inFakeAsync) {
            tick(0);
        }
        return callback();
    }, options);
}
/**
 * Wrap waitForElementToBeRemovedWrapper to poke the Angular change detection cycle before invoking the callback
 */
async function waitForElementToBeRemovedWrapper(detectChanges, callback, options) {
    let cb;
    if (typeof callback !== 'function') {
        const elements = (Array.isArray(callback) ? callback : [callback]);
        const getRemainingElements = elements.map((element) => {
            let parent = element.parentElement;
            while (parent.parentElement) {
                parent = parent.parentElement;
            }
            return () => (parent.contains(element) ? element : null);
        });
        cb = () => getRemainingElements.map((c) => c()).find(Boolean);
    }
    else {
        cb = callback;
    }
    return await dtlWaitForElementToBeRemoved(() => {
        const result = cb();
        detectChanges();
        return result;
    }, options);
}
function cleanup() {
    mountedFixtures.forEach(cleanupAtFixture);
}
function cleanupAtFixture(fixture) {
    fixture.destroy();
    if (!fixture.nativeElement.getAttribute('ng-version') && fixture.nativeElement.parentNode === document.body) {
        document.body.removeChild(fixture.nativeElement);
    }
    else if (!fixture.nativeElement.getAttribute('id') && document.body.children?.[0] === fixture.nativeElement) {
        document.body.removeChild(fixture.nativeElement);
    }
    mountedFixtures.delete(fixture);
}
// if we're running in a test runner that supports afterEach
// then we'll automatically run cleanup afterEach test
// this ensures that tests run in isolation from each other
// if you don't like this, set the ATL_SKIP_AUTO_CLEANUP env variable to 'true'
if (typeof process === 'undefined' || !process.env?.ATL_SKIP_AUTO_CLEANUP) {
    if (typeof afterEach === 'function') {
        afterEach(() => {
            cleanup();
        });
    }
}
class WrapperComponent {
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.0.2", ngImport: i0, type: WrapperComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "17.0.2", type: WrapperComponent, selector: "atl-wrapper-component", ngImport: i0, template: '', isInline: true }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.0.2", ngImport: i0, type: WrapperComponent, decorators: [{
            type: Component,
            args: [{ selector: 'atl-wrapper-component', template: '' }]
        }] });
/**
 * Wrap findBy queries to poke the Angular change detection cycle
 */
function replaceFindWithFindAndDetectChanges(originalQueriesForContainer) {
    return Object.keys(originalQueriesForContainer).reduce((newQueries, key) => {
        const getByQuery = originalQueriesForContainer[key.replace('find', 'get')];
        if (key.startsWith('find') && getByQuery) {
            newQueries[key] = async (...queryOptions) => {
                const waitOptions = queryOptions.length === 3 ? queryOptions.pop() : undefined;
                // original implementation at https://github.com/testing-library/dom-testing-library/blob/main/src/query-helpers.js
                return await waitForWrapper(detectChangesForMountedFixtures, () => getByQuery(...queryOptions), waitOptions);
            };
        }
        else {
            newQueries[key] = originalQueriesForContainer[key];
        }
        return newQueries;
    }, {});
}
/**
 * Call detectChanges for all fixtures
 */
function detectChangesForMountedFixtures() {
    mountedFixtures.forEach((fixture) => {
        try {
            fixture.detectChanges();
        }
        catch (err) {
            if (!err.message.startsWith('ViewDestroyedError')) {
                throw err;
            }
        }
    });
}
/**
 * Re-export screen with patched queries
 */
const screen = replaceFindWithFindAndDetectChanges(dtlScreen);
/**
 * Re-export within with patched queries
 */
const within = (element, queriesToBind) => {
    const container = dtlWithin(element, queriesToBind);
    return replaceFindWithFindAndDetectChanges(container);
};
/**
 * Re-export waitFor with patched waitFor
 */
async function waitFor(callback, options) {
    return waitForWrapper(detectChangesForMountedFixtures, callback, options);
}
/**
 * Re-export waitForElementToBeRemoved with patched waitForElementToBeRemoved
 */
async function waitForElementToBeRemoved(callback, options) {
    return waitForElementToBeRemovedWrapper(detectChangesForMountedFixtures, callback, options);
}
/**
 * Manually export otherwise we get the following error while running Jest tests
 * TypeError: Cannot set property fireEvent of [object Object] which has only a getter
 * exports.fireEvent = fireEvent
 */
export { fireEvent, buildQueries, getByLabelText, getAllByLabelText, queryByLabelText, queryAllByLabelText, findByLabelText, findAllByLabelText, getByPlaceholderText, getAllByPlaceholderText, queryByPlaceholderText, queryAllByPlaceholderText, findByPlaceholderText, findAllByPlaceholderText, getByText, getAllByText, queryByText, queryAllByText, findByText, findAllByText, getByAltText, getAllByAltText, queryByAltText, queryAllByAltText, findByAltText, findAllByAltText, getByTitle, getAllByTitle, queryByTitle, queryAllByTitle, findByTitle, findAllByTitle, getByDisplayValue, getAllByDisplayValue, queryByDisplayValue, queryAllByDisplayValue, findByDisplayValue, findAllByDisplayValue, getByRole, getAllByRole, queryByRole, queryAllByRole, findByRole, findAllByRole, getByTestId, getAllByTestId, queryByTestId, queryAllByTestId, findByTestId, findAllByTestId, createEvent, getDefaultNormalizer, getElementError, getNodeText, getQueriesForElement, getRoles, isInaccessible, logDOM, logRoles, prettyDOM, queries, queryAllByAttribute, queryByAttribute, queryHelpers, } from '@testing-library/dom';
// export patched dtl
export { screen, waitFor, waitForElementToBeRemoved, within };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdGluZy1saWJyYXJ5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvdGVzdGluZy1saWJyYXJ5L3NyYy9saWIvdGVzdGluZy1saWJyYXJ5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxpQkFBaUIsRUFDakIsU0FBUyxFQUVULE1BQU0sRUFDTixZQUFZLEVBR1oscUJBQXFCLEVBQ3JCLFlBQVksR0FDYixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQW9CLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUN4RSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUNyRyxPQUFPLEVBQW9CLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQzlELE9BQU8sRUFDTCxvQkFBb0IsSUFBSSx1QkFBdUIsRUFDL0MsU0FBUyxJQUFJLFlBQVksRUFDekIsT0FBTyxJQUFJLFVBQVUsRUFDckIseUJBQXlCLElBQUksNEJBQTRCLEVBQ3pELE1BQU0sSUFBSSxTQUFTLEVBQ25CLE1BQU0sSUFBSSxTQUFTLEVBRW5CLFNBQVMsSUFBSSxZQUFZLEdBRTFCLE1BQU0sc0JBQXNCLENBQUM7QUFHOUIsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFVBQVUsQ0FBQzs7QUFFckMsTUFBTSxlQUFlLEdBQUcsSUFBSSxHQUFHLEVBQXlCLENBQUM7QUFDekQsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLE1BQU0sSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDO0FBV2pELE1BQU0sQ0FBQyxLQUFLLFVBQVUsTUFBTSxDQUMxQixHQUEyQixFQUMzQixnQkFBc0YsRUFBRTtJQUV4RixNQUFNLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxHQUFHLFlBQVks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ZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIFR5cGUsXG4gIE5nWm9uZSxcbiAgU2ltcGxlQ2hhbmdlLFxuICBPbkNoYW5nZXMsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIEFwcGxpY2F0aW9uSW5pdFN0YXR1cyxcbiAgaXNTdGFuZGFsb25lLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbXBvbmVudEZpeHR1cmUsIFRlc3RCZWQsIHRpY2sgfSBmcm9tICdAYW5ndWxhci9jb3JlL3Rlc3RpbmcnO1xuaW1wb3J0IHsgQnJvd3NlckFuaW1hdGlvbnNNb2R1bGUsIE5vb3BBbmltYXRpb25zTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlci9hbmltYXRpb25zJztcbmltcG9ydCB7IE5hdmlnYXRpb25FeHRyYXMsIFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBSb3V0ZXJUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyL3Rlc3RpbmcnO1xuaW1wb3J0IHtcbiAgZ2V0UXVlcmllc0ZvckVsZW1lbnQgYXMgZHRsR2V0UXVlcmllc0ZvckVsZW1lbnQsXG4gIHByZXR0eURPTSBhcyBkdGxQcmV0dHlET00sXG4gIHdhaXRGb3IgYXMgZHRsV2FpdEZvcixcbiAgd2FpdEZvckVsZW1lbnRUb0JlUmVtb3ZlZCBhcyBkdGxXYWl0Rm9yRWxlbWVudFRvQmVSZW1vdmVkLFxuICBzY3JlZW4gYXMgZHRsU2NyZWVuLFxuICB3aXRoaW4gYXMgZHRsV2l0aGluLFxuICB3YWl0Rm9yT3B0aW9ucyBhcyBkdGxXYWl0Rm9yT3B0aW9ucyxcbiAgY29uZmlndXJlIGFzIGR0bENvbmZpZ3VyZSxcbiAgcXVlcmllcyBhcyBkdGxRdWVyaWVzLFxufSBmcm9tICdAdGVzdGluZy1saWJyYXJ5L2RvbSc7XG5pbXBvcnQgdHlwZSB7IFF1ZXJpZXMsIEJvdW5kRnVuY3Rpb25zIH0gZnJvbSAnQHRlc3RpbmctbGlicmFyeS9kb20nO1xuaW1wb3J0IHsgUmVuZGVyQ29tcG9uZW50T3B0aW9ucywgUmVuZGVyVGVtcGxhdGVPcHRpb25zLCBSZW5kZXJSZXN1bHQsIENvbXBvbmVudE92ZXJyaWRlIH0gZnJvbSAnLi9tb2RlbHMnO1xuaW1wb3J0IHsgZ2V0Q29uZmlnIH0gZnJvbSAnLi9jb25maWcnO1xuXG5jb25zdCBtb3VudGVkRml4dHVyZXMgPSBuZXcgU2V0PENvbXBvbmVudEZpeHR1cmU8YW55Pj4oKTtcbmNvbnN0IHNhZmVJbmplY3QgPSBUZXN0QmVkLmluamVjdCB8fCBUZXN0QmVkLmdldDtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlbmRlcjxDb21wb25lbnRUeXBlPihcbiAgY29tcG9uZW50OiBUeXBlPENvbXBvbmVudFR5cGU+LFxuICByZW5kZXJPcHRpb25zPzogUmVuZGVyQ29tcG9uZW50T3B0aW9uczxDb21wb25lbnRUeXBlPixcbik6IFByb21pc2U8UmVuZGVyUmVzdWx0PENvbXBvbmVudFR5cGUsIENvbXBvbmVudFR5cGU+PjtcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZW5kZXI8V3JhcHBlclR5cGUgPSBXcmFwcGVyQ29tcG9uZW50PihcbiAgdGVtcGxhdGU6IHN0cmluZyxcbiAgcmVuZGVyT3B0aW9ucz86IFJlbmRlclRlbXBsYXRlT3B0aW9uczxXcmFwcGVyVHlwZT4sXG4pOiBQcm9taXNlPFJlbmRlclJlc3VsdDxXcmFwcGVyVHlwZT4+O1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVuZGVyPFN1dFR5cGUsIFdyYXBwZXJUeXBlID0gU3V0VHlwZT4oXG4gIHN1dDogVHlwZTxTdXRUeXBlPiB8IHN0cmluZyxcbiAgcmVuZGVyT3B0aW9uczogUmVuZGVyQ29tcG9uZW50T3B0aW9uczxTdXRUeXBlPiB8IFJlbmRlclRlbXBsYXRlT3B0aW9uczxXcmFwcGVyVHlwZT4gPSB7fSxcbik6IFByb21pc2U8UmVuZGVyUmVzdWx0PFN1dFR5cGU+PiB7XG4gIGNvbnN0IHsgZG9tOiBkb21Db25maWcsIC4uLmdsb2JhbENvbmZpZyB9ID0gZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IHtcbiAgICBkZXRlY3RDaGFuZ2VzT25SZW5kZXIgPSB0cnVlLFxuICAgIGF1dG9EZXRlY3RDaGFuZ2VzID0gdHJ1ZSxcbiAgICBkZWNsYXJhdGlvbnMgPSBbXSxcbiAgICBpbXBvcnRzID0gW10sXG4gICAgcHJvdmlkZXJzID0gW10sXG4gICAgc2NoZW1hcyA9IFtdLFxuICAgIHF1ZXJpZXMsXG4gICAgd3JhcHBlciA9IFdyYXBwZXJDb21wb25lbnQgYXMgVHlwZTxXcmFwcGVyVHlwZT4sXG4gICAgY29tcG9uZW50UHJvcGVydGllcyA9IHt9LFxuICAgIGNvbXBvbmVudElucHV0cyA9IHt9LFxuICAgIGNvbXBvbmVudE91dHB1dHMgPSB7fSxcbiAgICBjb21wb25lbnRQcm92aWRlcnMgPSBbXSxcbiAgICBjaGlsZENvbXBvbmVudE92ZXJyaWRlcyA9IFtdLFxuICAgIGNvbXBvbmVudEltcG9ydHM6IGNvbXBvbmVudEltcG9ydHMsXG4gICAgZXhjbHVkZUNvbXBvbmVudERlY2xhcmF0aW9uID0gZmFsc2UsXG4gICAgcm91dGVzID0gW10sXG4gICAgcmVtb3ZlQW5ndWxhckF0dHJpYnV0ZXMgPSBmYWxzZSxcbiAgICBkZWZhdWx0SW1wb3J0cyA9IFtdLFxuICAgIGluaXRpYWxSb3V0ZSA9ICcnLFxuICAgIGNvbmZpZ3VyZVRlc3RCZWQgPSAoKSA9PiB7XG4gICAgICAvKiBub29wKi9cbiAgICB9LFxuICB9ID0geyAuLi5nbG9iYWxDb25maWcsIC4uLnJlbmRlck9wdGlvbnMgfTtcblxuICBkdGxDb25maWd1cmUoe1xuICAgIGV2ZW50V3JhcHBlcjogKGNiKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBjYigpO1xuICAgICAgaWYgKGF1dG9EZXRlY3RDaGFuZ2VzKSB7XG4gICAgICAgIGRldGVjdENoYW5nZXNGb3JNb3VudGVkRml4dHVyZXMoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcbiAgICAuLi5kb21Db25maWcsXG4gIH0pO1xuXG4gIFRlc3RCZWQuY29uZmlndXJlVGVzdGluZ01vZHVsZSh7XG4gICAgZGVjbGFyYXRpb25zOiBhZGRBdXRvRGVjbGFyYXRpb25zKHN1dCwge1xuICAgICAgZGVjbGFyYXRpb25zLFxuICAgICAgZXhjbHVkZUNvbXBvbmVudERlY2xhcmF0aW9uLFxuICAgICAgd3JhcHBlcixcbiAgICB9KSxcbiAgICBpbXBvcnRzOiBhZGRBdXRvSW1wb3J0cyhzdXQsIHtcbiAgICAgIGltcG9ydHM6IGltcG9ydHMuY29uY2F0KGRlZmF1bHRJbXBvcnRzKSxcbiAgICAgIHJvdXRlcyxcbiAgICB9KSxcbiAgICBwcm92aWRlcnM6IFsuLi5wcm92aWRlcnNdLFxuICAgIHNjaGVtYXM6IFsuLi5zY2hlbWFzXSxcbiAgfSk7XG4gIG92ZXJyaWRlQ29tcG9uZW50SW1wb3J0cyhzdXQsIGNvbXBvbmVudEltcG9ydHMpO1xuICBvdmVycmlkZUNoaWxkQ29tcG9uZW50UHJvdmlkZXJzKGNoaWxkQ29tcG9uZW50T3ZlcnJpZGVzKTtcblxuICBjb25maWd1cmVUZXN0QmVkKFRlc3RCZWQpO1xuXG4gIGF3YWl0IFRlc3RCZWQuY29tcGlsZUNvbXBvbmVudHMoKTtcblxuICBjb21wb25lbnRQcm92aWRlcnNcbiAgICAucmVkdWNlKChhY2MsIHByb3ZpZGVyKSA9PiBhY2MuY29uY2F0KHByb3ZpZGVyKSwgW10gYXMgYW55W10pXG4gICAgLmZvckVhY2goKHA6IGFueSkgPT4ge1xuICAgICAgY29uc3QgeyBwcm92aWRlLCAuLi5wcm92aWRlciB9ID0gcDtcbiAgICAgIFRlc3RCZWQub3ZlcnJpZGVQcm92aWRlcihwcm92aWRlLCBwcm92aWRlcik7XG4gICAgfSk7XG5cbiAgY29uc3QgY29tcG9uZW50Q29udGFpbmVyID0gY3JlYXRlQ29tcG9uZW50Rml4dHVyZShzdXQsIHdyYXBwZXIpO1xuXG4gIGNvbnN0IHpvbmUgPSBzYWZlSW5qZWN0KE5nWm9uZSk7XG4gIGNvbnN0IHJvdXRlciA9IHNhZmVJbmplY3QoUm91dGVyKTtcbiAgY29uc3QgX25hdmlnYXRlID0gYXN5bmMgKGVsZW1lbnRPclBhdGg6IEVsZW1lbnQgfCBzdHJpbmcsIGJhc2VQYXRoID0gJycpOiBQcm9taXNlPGJvb2xlYW4+ID0+IHtcbiAgICBjb25zdCBocmVmID0gdHlwZW9mIGVsZW1lbnRPclBhdGggPT09ICdzdHJpbmcnID8gZWxlbWVudE9yUGF0aCA6IGVsZW1lbnRPclBhdGguZ2V0QXR0cmlidXRlKCdocmVmJyk7XG4gICAgY29uc3QgW3BhdGgsIHBhcmFtc10gPSAoYmFzZVBhdGggKyBocmVmKS5zcGxpdCgnPycpO1xuICAgIGNvbnN0IHF1ZXJ5UGFyYW1zID0gcGFyYW1zXG4gICAgICA/IHBhcmFtcy5zcGxpdCgnJicpLnJlZHVjZSgocXAsIHEpID0+IHtcbiAgICAgICAgICBjb25zdCBba2V5LCB2YWx1ZV0gPSBxLnNwbGl0KCc9Jyk7XG4gICAgICAgICAgY29uc3QgY3VycmVudFZhbHVlID0gcXBba2V5XTtcbiAgICAgICAgICBpZiAodHlwZW9mIGN1cnJlbnRWYWx1ZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHFwW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoY3VycmVudFZhbHVlKSkge1xuICAgICAgICAgICAgcXBba2V5XSA9IFsuLi5jdXJyZW50VmFsdWUsIHZhbHVlXTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcXBba2V5XSA9IFtjdXJyZW50VmFsdWUsIHZhbHVlXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHFwO1xuICAgICAgICB9LCB7fSBhcyBSZWNvcmQ8c3RyaW5nLCBzdHJpbmcgfCBzdHJpbmdbXT4pXG4gICAgICA6IHVuZGVmaW5lZDtcblxuICAgIGNvbnN0IG5hdmlnYXRlT3B0aW9uczogTmF2aWdhdGlvbkV4dHJhcyB8IHVuZGVmaW5lZCA9IHF1ZXJ5UGFyYW1zXG4gICAgICA/IHtcbiAgICAgICAgICBxdWVyeVBhcmFtcyxcbiAgICAgICAgfVxuICAgICAgOiB1bmRlZmluZWQ7XG5cbiAgICBjb25zdCBkb05hdmlnYXRlID0gKCkgPT4ge1xuICAgICAgcmV0dXJuIG5hdmlnYXRlT3B0aW9ucyA/IHJvdXRlcj8ubmF2aWdhdGUoW3BhdGhdLCBuYXZpZ2F0ZU9wdGlvbnMpIDogcm91dGVyPy5uYXZpZ2F0ZShbcGF0aF0pO1xuICAgIH07XG5cbiAgICBsZXQgcmVzdWx0O1xuXG4gICAgaWYgKHpvbmUpIHtcbiAgICAgIGF3YWl0IHpvbmUucnVuKCgpID0+IChyZXN1bHQgPSBkb05hdmlnYXRlKCkpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzdWx0ID0gZG9OYXZpZ2F0ZSgpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0ID8/IGZhbHNlO1xuICB9O1xuXG4gIGlmIChpbml0aWFsUm91dGUpIGF3YWl0IF9uYXZpZ2F0ZShpbml0aWFsUm91dGUpO1xuXG4gIGlmICh0eXBlb2Ygcm91dGVyPy5pbml0aWFsTmF2aWdhdGlvbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIGlmICh6b25lKSB7XG4gICAgICB6b25lLnJ1bigoKSA9PiByb3V0ZXIuaW5pdGlhbE5hdmlnYXRpb24oKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJvdXRlci5pbml0aWFsTmF2aWdhdGlvbigpO1xuICAgIH1cbiAgfVxuXG4gIGxldCBmaXh0dXJlOiBDb21wb25lbnRGaXh0dXJlPFN1dFR5cGU+O1xuICBsZXQgZGV0ZWN0Q2hhbmdlczogKCkgPT4gdm9pZDtcblxuICBhd2FpdCByZW5kZXJGaXh0dXJlKGNvbXBvbmVudFByb3BlcnRpZXMsIGNvbXBvbmVudElucHV0cywgY29tcG9uZW50T3V0cHV0cyk7XG5cbiAgbGV0IHJlbmRlcmVkUHJvcEtleXMgPSBPYmplY3Qua2V5cyhjb21wb25lbnRQcm9wZXJ0aWVzKTtcbiAgbGV0IHJlbmRlcmVkSW5wdXRLZXlzID0gT2JqZWN0LmtleXMoY29tcG9uZW50SW5wdXRzKTtcbiAgbGV0IHJlbmRlcmVkT3V0cHV0S2V5cyA9IE9iamVjdC5rZXlzKGNvbXBvbmVudE91dHB1dHMpO1xuICBjb25zdCByZXJlbmRlciA9IGFzeW5jIChcbiAgICBwcm9wZXJ0aWVzPzogUGljazxcbiAgICAgIFJlbmRlclRlbXBsYXRlT3B0aW9uczxTdXRUeXBlPixcbiAgICAgICdjb21wb25lbnRQcm9wZXJ0aWVzJyB8ICdjb21wb25lbnRJbnB1dHMnIHwgJ2NvbXBvbmVudE91dHB1dHMnIHwgJ2RldGVjdENoYW5nZXNPblJlbmRlcidcbiAgICA+LFxuICApID0+IHtcbiAgICBjb25zdCBuZXdDb21wb25lbnRJbnB1dHMgPSBwcm9wZXJ0aWVzPy5jb21wb25lbnRJbnB1dHMgPz8ge307XG4gICAgY29uc3QgY2hhbmdlc0luQ29tcG9uZW50SW5wdXQgPSB1cGRhdGUoZml4dHVyZSwgcmVuZGVyZWRJbnB1dEtleXMsIG5ld0NvbXBvbmVudElucHV0cywgc2V0Q29tcG9uZW50SW5wdXRzKTtcbiAgICByZW5kZXJlZElucHV0S2V5cyA9IE9iamVjdC5rZXlzKG5ld0NvbXBvbmVudElucHV0cyk7XG5cbiAgICBjb25zdCBuZXdDb21wb25lbnRPdXRwdXRzID0gcHJvcGVydGllcz8uY29tcG9uZW50T3V0cHV0cyA/PyB7fTtcbiAgICBmb3IgKGNvbnN0IG91dHB1dEtleSBvZiByZW5kZXJlZE91dHB1dEtleXMpIHtcbiAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG5ld0NvbXBvbmVudE91dHB1dHMsIG91dHB1dEtleSkpIHtcbiAgICAgICAgZGVsZXRlIChmaXh0dXJlLmNvbXBvbmVudEluc3RhbmNlIGFzIGFueSlbb3V0cHV0S2V5XTtcbiAgICAgIH1cbiAgICB9XG4gICAgc2V0Q29tcG9uZW50T3V0cHV0cyhmaXh0dXJlLCBuZXdDb21wb25lbnRPdXRwdXRzKTtcbiAgICByZW5kZXJlZE91dHB1dEtleXMgPSBPYmplY3Qua2V5cyhuZXdDb21wb25lbnRPdXRwdXRzKTtcblxuICAgIGNvbnN0IG5ld0NvbXBvbmVudFByb3BzID0gcHJvcGVydGllcz8uY29tcG9uZW50UHJvcGVydGllcyA/PyB7fTtcbiAgICBjb25zdCBjaGFuZ2VzSW5Db21wb25lbnRQcm9wcyA9IHVwZGF0ZShmaXh0dXJlLCByZW5kZXJlZFByb3BLZXlzLCBuZXdDb21wb25lbnRQcm9wcywgc2V0Q29tcG9uZW50UHJvcGVydGllcyk7XG4gICAgcmVuZGVyZWRQcm9wS2V5cyA9IE9iamVjdC5rZXlzKG5ld0NvbXBvbmVudFByb3BzKTtcblxuICAgIGlmIChoYXNPbkNoYW5nZXNIb29rKGZpeHR1cmUuY29tcG9uZW50SW5zdGFuY2UpKSB7XG4gICAgICBmaXh0dXJlLmNvbXBvbmVudEluc3RhbmNlLm5nT25DaGFuZ2VzKHtcbiAgICAgICAgLi4uY2hhbmdlc0luQ29tcG9uZW50SW5wdXQsXG4gICAgICAgIC4uLmNoYW5nZXNJbkNvbXBvbmVudFByb3BzLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKHByb3BlcnRpZXM/LmRldGVjdENoYW5nZXNPblJlbmRlciAhPT0gZmFsc2UpIHtcbiAgICAgIGZpeHR1cmUuY29tcG9uZW50UmVmLmluamVjdG9yLmdldChDaGFuZ2VEZXRlY3RvclJlZikuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBuYXZpZ2F0ZSA9IGFzeW5jIChlbGVtZW50T3JQYXRoOiBFbGVtZW50IHwgc3RyaW5nLCBiYXNlUGF0aCA9ICcnKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgX25hdmlnYXRlKGVsZW1lbnRPclBhdGgsIGJhc2VQYXRoKTtcbiAgICBkZXRlY3RDaGFuZ2VzKCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIC8vIEB0cy1pZ25vcmU6IGZpeHR1cmUgYXNzaWduZWRcbiAgICBmaXh0dXJlLFxuICAgIGRldGVjdENoYW5nZXM6ICgpID0+IGRldGVjdENoYW5nZXMoKSxcbiAgICBuYXZpZ2F0ZSxcbiAgICByZXJlbmRlcixcbiAgICAvLyBAdHMtaWdub3JlOiBmaXh0dXJlIGFzc2lnbmVkXG4gICAgZGVidWdFbGVtZW50OiBmaXh0dXJlLmRlYnVnRWxlbWVudCxcbiAgICAvLyBAdHMtaWdub3JlOiBmaXh0dXJlIGFzc2lnbmVkXG4gICAgY29udGFpbmVyOiBmaXh0dXJlLm5hdGl2ZUVsZW1lbnQsXG4gICAgZGVidWc6IChlbGVtZW50ID0gZml4dHVyZS5uYXRpdmVFbGVtZW50LCBtYXhMZW5ndGgsIG9wdGlvbnMpID0+XG4gICAgICBBcnJheS5pc0FycmF5KGVsZW1lbnQpXG4gICAgICAgID8gZWxlbWVudC5mb3JFYWNoKChlKSA9PiBjb25zb2xlLmxvZyhkdGxQcmV0dHlET00oZSwgbWF4TGVuZ3RoLCBvcHRpb25zKSkpXG4gICAgICAgIDogY29uc29sZS5sb2coZHRsUHJldHR5RE9NKGVsZW1lbnQsIG1heExlbmd0aCwgb3B0aW9ucykpLFxuICAgIC8vIEB0cy1pZ25vcmU6IGZpeHR1cmUgYXNzaWduZWRcbiAgICAuLi5yZXBsYWNlRmluZFdpdGhGaW5kQW5kRGV0ZWN0Q2hhbmdlcyhkdGxHZXRRdWVyaWVzRm9yRWxlbWVudChmaXh0dXJlLm5hdGl2ZUVsZW1lbnQsIHF1ZXJpZXMpKSxcbiAgfTtcblxuICBhc3luYyBmdW5jdGlvbiByZW5kZXJGaXh0dXJlKHByb3BlcnRpZXM6IFBhcnRpYWw8U3V0VHlwZT4sIGlucHV0czogUGFydGlhbDxTdXRUeXBlPiwgb3V0cHV0czogUGFydGlhbDxTdXRUeXBlPikge1xuICAgIGlmIChmaXh0dXJlKSB7XG4gICAgICBjbGVhbnVwQXRGaXh0dXJlKGZpeHR1cmUpO1xuICAgIH1cblxuICAgIGZpeHR1cmUgPSBhd2FpdCBjcmVhdGVDb21wb25lbnQoY29tcG9uZW50Q29udGFpbmVyKTtcbiAgICBzZXRDb21wb25lbnRQcm9wZXJ0aWVzKGZpeHR1cmUsIHByb3BlcnRpZXMpO1xuICAgIHNldENvbXBvbmVudElucHV0cyhmaXh0dXJlLCBpbnB1dHMpO1xuICAgIHNldENvbXBvbmVudE91dHB1dHMoZml4dHVyZSwgb3V0cHV0cyk7XG5cbiAgICBpZiAocmVtb3ZlQW5ndWxhckF0dHJpYnV0ZXMpIHtcbiAgICAgIGZpeHR1cmUubmF0aXZlRWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ25nLXZlcnNpb24nKTtcbiAgICAgIGNvbnN0IGlkQXR0cmlidXRlID0gZml4dHVyZS5uYXRpdmVFbGVtZW50LmdldEF0dHJpYnV0ZSgnaWQnKTtcbiAgICAgIGlmIChpZEF0dHJpYnV0ZSAmJiBpZEF0dHJpYnV0ZS5zdGFydHNXaXRoKCdyb290JykpIHtcbiAgICAgICAgZml4dHVyZS5uYXRpdmVFbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnaWQnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBtb3VudGVkRml4dHVyZXMuYWRkKGZpeHR1cmUpO1xuXG4gICAgbGV0IGlzQWxpdmUgPSB0cnVlO1xuICAgIGZpeHR1cmUuY29tcG9uZW50UmVmLm9uRGVzdHJveSgoKSA9PiAoaXNBbGl2ZSA9IGZhbHNlKSk7XG5cbiAgICBpZiAoaGFzT25DaGFuZ2VzSG9vayhmaXh0dXJlLmNvbXBvbmVudEluc3RhbmNlKSAmJiBPYmplY3Qua2V5cyhwcm9wZXJ0aWVzKS5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBjaGFuZ2VzID0gZ2V0Q2hhbmdlc09iaihudWxsLCBjb21wb25lbnRQcm9wZXJ0aWVzKTtcbiAgICAgIGZpeHR1cmUuY29tcG9uZW50SW5zdGFuY2UubmdPbkNoYW5nZXMoY2hhbmdlcyk7XG4gICAgfVxuXG4gICAgZGV0ZWN0Q2hhbmdlcyA9ICgpID0+IHtcbiAgICAgIGlmIChpc0FsaXZlKSB7XG4gICAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBpZiAoZGV0ZWN0Q2hhbmdlc09uUmVuZGVyKSB7XG4gICAgICBkZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNvbXBvbmVudDxTdXRUeXBlPihjb21wb25lbnQ6IFR5cGU8U3V0VHlwZT4pOiBQcm9taXNlPENvbXBvbmVudEZpeHR1cmU8U3V0VHlwZT4+IHtcbiAgLyogTWFrZSBzdXJlIGFuZ3VsYXIgYXBwbGljYXRpb24gaXMgaW5pdGlhbGl6ZWQgYmVmb3JlIGNyZWF0aW5nIGNvbXBvbmVudCAqL1xuICBhd2FpdCBzYWZlSW5qZWN0KEFwcGxpY2F0aW9uSW5pdFN0YXR1cykuZG9uZVByb21pc2U7XG4gIHJldHVybiBUZXN0QmVkLmNyZWF0ZUNvbXBvbmVudChjb21wb25lbnQpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVDb21wb25lbnRGaXh0dXJlPFN1dFR5cGUsIFdyYXBwZXJUeXBlPihcbiAgc3V0OiBUeXBlPFN1dFR5cGU+IHwgc3RyaW5nLFxuICB3cmFwcGVyOiBUeXBlPFdyYXBwZXJUeXBlPixcbik6IFR5cGU8YW55PiB7XG4gIGlmICh0eXBlb2Ygc3V0ID09PSAnc3RyaW5nJykge1xuICAgIFRlc3RCZWQub3ZlcnJpZGVUZW1wbGF0ZSh3cmFwcGVyLCBzdXQpO1xuICAgIHJldHVybiB3cmFwcGVyO1xuICB9XG4gIHJldHVybiBzdXQ7XG59XG5cbmZ1bmN0aW9uIHNldENvbXBvbmVudFByb3BlcnRpZXM8U3V0VHlwZT4oXG4gIGZpeHR1cmU6IENvbXBvbmVudEZpeHR1cmU8U3V0VHlwZT4sXG4gIGNvbXBvbmVudFByb3BlcnRpZXM6IFJlbmRlclRlbXBsYXRlT3B0aW9uczxTdXRUeXBlLCBhbnk+Wydjb21wb25lbnRQcm9wZXJ0aWVzJ10gPSB7fSxcbikge1xuICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhjb21wb25lbnRQcm9wZXJ0aWVzKSkge1xuICAgIGNvbnN0IGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKChmaXh0dXJlLmNvbXBvbmVudEluc3RhbmNlIGFzIGFueSkuY29uc3RydWN0b3IucHJvdG90eXBlLCBrZXkpO1xuICAgIGxldCBfdmFsdWUgPSBjb21wb25lbnRQcm9wZXJ0aWVzW2tleV07XG4gICAgY29uc3QgZGVmYXVsdEdldHRlciA9ICgpID0+IF92YWx1ZTtcbiAgICBjb25zdCBleHRlbmRlZFNldHRlciA9ICh2YWx1ZTogYW55KSA9PiB7XG4gICAgICBfdmFsdWUgPSB2YWx1ZTtcbiAgICAgIGRlc2NyaXB0b3I/LnNldD8uY2FsbChmaXh0dXJlLmNvbXBvbmVudEluc3RhbmNlLCBfdmFsdWUpO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfTtcblxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShmaXh0dXJlLmNvbXBvbmVudEluc3RhbmNlLCBrZXksIHtcbiAgICAgIGdldDogZGVzY3JpcHRvcj8uZ2V0IHx8IGRlZmF1bHRHZXR0ZXIsXG4gICAgICBzZXQ6IGV4dGVuZGVkU2V0dGVyLFxuICAgICAgLy8gQWxsb3cgdGhlIHByb3BlcnR5IHRvIGJlIGRlZmluZWQgYWdhaW4gbGF0ZXIuXG4gICAgICAvLyBUaGlzIGhhcHBlbnMgd2hlbiB0aGUgY29tcG9uZW50IHByb3BlcnRpZXMgYXJlIHVwZGF0ZWQgYWZ0ZXIgaW5pdGlhbCByZW5kZXIuXG4gICAgICAvLyBGb3IgSmVzdCB0aGlzIGlzIGB0cnVlYCBieSBkZWZhdWx0LCBmb3IgS2FybWEgYW5kIGEgcmVhbCBicm93c2VyIHRoZSBkZWZhdWx0IGlzIGBmYWxzZWBcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICB9KTtcblxuICAgIGRlc2NyaXB0b3I/LnNldD8uY2FsbChmaXh0dXJlLmNvbXBvbmVudEluc3RhbmNlLCBfdmFsdWUpO1xuICB9XG4gIHJldHVybiBmaXh0dXJlO1xufVxuXG5mdW5jdGlvbiBzZXRDb21wb25lbnRPdXRwdXRzPFN1dFR5cGU+KFxuICBmaXh0dXJlOiBDb21wb25lbnRGaXh0dXJlPFN1dFR5cGU+LFxuICBjb21wb25lbnRPdXRwdXRzOiBSZW5kZXJUZW1wbGF0ZU9wdGlvbnM8U3V0VHlwZSwgYW55PlsnY29tcG9uZW50T3V0cHV0cyddID0ge30sXG4pIHtcbiAgZm9yIChjb25zdCBbbmFtZSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGNvbXBvbmVudE91dHB1dHMpKSB7XG4gICAgKGZpeHR1cmUuY29tcG9uZW50SW5zdGFuY2UgYXMgYW55KVtuYW1lXSA9IHZhbHVlO1xuICB9XG59XG5cbmZ1bmN0aW9uIHNldENvbXBvbmVudElucHV0czxTdXRUeXBlPihcbiAgZml4dHVyZTogQ29tcG9uZW50Rml4dHVyZTxTdXRUeXBlPixcbiAgY29tcG9uZW50SW5wdXRzOiBSZW5kZXJUZW1wbGF0ZU9wdGlvbnM8U3V0VHlwZT5bJ2NvbXBvbmVudElucHV0cyddID0ge30sXG4pIHtcbiAgZm9yIChjb25zdCBbbmFtZSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGNvbXBvbmVudElucHV0cykpIHtcbiAgICBmaXh0dXJlLmNvbXBvbmVudFJlZi5zZXRJbnB1dChuYW1lLCB2YWx1ZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gb3ZlcnJpZGVDb21wb25lbnRJbXBvcnRzPFN1dFR5cGU+KHN1dDogVHlwZTxTdXRUeXBlPiB8IHN0cmluZywgaW1wb3J0czogKFR5cGU8YW55PiB8IGFueVtdKVtdIHwgdW5kZWZpbmVkKSB7XG4gIGlmIChpbXBvcnRzKSB7XG4gICAgaWYgKHR5cGVvZiBzdXQgPT09ICdmdW5jdGlvbicgJiYgaXNTdGFuZGFsb25lKHN1dCkpIHtcbiAgICAgIFRlc3RCZWQub3ZlcnJpZGVDb21wb25lbnQoc3V0LCB7IHNldDogeyBpbXBvcnRzIH0gfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEVycm9yIHdoaWxlIHJlbmRlcmluZyAke3N1dH06IENhbm5vdCBzcGVjaWZ5IGNvbXBvbmVudEltcG9ydHMgb24gYSB0ZW1wbGF0ZSBvciBub24tc3RhbmRhbG9uZSBjb21wb25lbnQuYCxcbiAgICAgICk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIG92ZXJyaWRlQ2hpbGRDb21wb25lbnRQcm92aWRlcnMoY29tcG9uZW50T3ZlcnJpZGVzOiBDb21wb25lbnRPdmVycmlkZTxhbnk+W10pIHtcbiAgY29tcG9uZW50T3ZlcnJpZGVzPy5mb3JFYWNoKCh7IGNvbXBvbmVudCwgcHJvdmlkZXJzIH0pID0+IHtcbiAgICBUZXN0QmVkLm92ZXJyaWRlQ29tcG9uZW50KGNvbXBvbmVudCwgeyBzZXQ6IHsgcHJvdmlkZXJzIH0gfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBoYXNPbkNoYW5nZXNIb29rPFN1dFR5cGU+KGNvbXBvbmVudEluc3RhbmNlOiBTdXRUeXBlKTogY29tcG9uZW50SW5zdGFuY2UgaXMgU3V0VHlwZSAmIE9uQ2hhbmdlcyB7XG4gIHJldHVybiAoXG4gICAgY29tcG9uZW50SW5zdGFuY2UgIT09IG51bGwgJiZcbiAgICB0eXBlb2YgY29tcG9uZW50SW5zdGFuY2UgPT09ICdvYmplY3QnICYmXG4gICAgJ25nT25DaGFuZ2VzJyBpbiBjb21wb25lbnRJbnN0YW5jZSAmJlxuICAgIHR5cGVvZiAoY29tcG9uZW50SW5zdGFuY2UgYXMgU3V0VHlwZSAmIE9uQ2hhbmdlcykubmdPbkNoYW5nZXMgPT09ICdmdW5jdGlvbidcbiAgKTtcbn1cblxuZnVuY3Rpb24gZ2V0Q2hhbmdlc09iaihvbGRQcm9wczogUmVjb3JkPHN0cmluZywgYW55PiB8IG51bGwsIG5ld1Byb3BzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KSB7XG4gIGNvbnN0IGlzRmlyc3RDaGFuZ2UgPSBvbGRQcm9wcyA9PT0gbnVsbDtcbiAgcmV0dXJuIE9iamVjdC5rZXlzKG5ld1Byb3BzKS5yZWR1Y2U8U2ltcGxlQ2hhbmdlcz4oXG4gICAgKGNoYW5nZXMsIGtleSkgPT4gKHtcbiAgICAgIC4uLmNoYW5nZXMsXG4gICAgICBba2V5XTogbmV3IFNpbXBsZUNoYW5nZShpc0ZpcnN0Q2hhbmdlID8gbnVsbCA6IG9sZFByb3BzW2tleV0sIG5ld1Byb3BzW2tleV0sIGlzRmlyc3RDaGFuZ2UpLFxuICAgIH0pLFxuICAgIHt9IGFzIFJlY29yZDxzdHJpbmcsIGFueT4sXG4gICk7XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZTxTdXRUeXBlPihcbiAgZml4dHVyZTogQ29tcG9uZW50Rml4dHVyZTxTdXRUeXBlPixcbiAgcHJldlJlbmRlcmVkS2V5czogc3RyaW5nW10sXG4gIG5ld1ZhbHVlczogUmVjb3JkPHN0cmluZywgYW55PixcbiAgdXBkYXRlRnVuY3Rpb246IChcbiAgICBmaXh0dXJlOiBDb21wb25lbnRGaXh0dXJlPFN1dFR5cGU+LFxuICAgIHZhbHVlczogUmVuZGVyVGVtcGxhdGVPcHRpb25zPFN1dFR5cGU+Wydjb21wb25lbnRJbnB1dHMnIHwgJ2NvbXBvbmVudFByb3BlcnRpZXMnXSxcbiAgKSA9PiB2b2lkLFxuKSB7XG4gIGNvbnN0IGNvbXBvbmVudEluc3RhbmNlID0gZml4dHVyZS5jb21wb25lbnRJbnN0YW5jZSBhcyBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICBjb25zdCBzaW1wbGVDaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzID0ge307XG5cbiAgZm9yIChjb25zdCBrZXkgb2YgcHJldlJlbmRlcmVkS2V5cykge1xuICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG5ld1ZhbHVlcywga2V5KSkge1xuICAgICAgc2ltcGxlQ2hhbmdlc1trZXldID0gbmV3IFNpbXBsZUNoYW5nZShjb21wb25lbnRJbnN0YW5jZVtrZXldLCB1bmRlZmluZWQsIGZhbHNlKTtcbiAgICAgIGRlbGV0ZSBjb21wb25lbnRJbnN0YW5jZVtrZXldO1xuICAgIH1cbiAgfVxuXG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKG5ld1ZhbHVlcykpIHtcbiAgICBpZiAodmFsdWUgIT09IGNvbXBvbmVudEluc3RhbmNlW2tleV0pIHtcbiAgICAgIHNpbXBsZUNoYW5nZXNba2V5XSA9IG5ldyBTaW1wbGVDaGFuZ2UoY29tcG9uZW50SW5zdGFuY2Vba2V5XSwgdmFsdWUsIGZhbHNlKTtcbiAgICB9XG4gIH1cblxuICB1cGRhdGVGdW5jdGlvbihmaXh0dXJlLCBuZXdWYWx1ZXMpO1xuXG4gIHJldHVybiBzaW1wbGVDaGFuZ2VzO1xufVxuXG5mdW5jdGlvbiBhZGRBdXRvRGVjbGFyYXRpb25zPFN1dFR5cGU+KFxuICBzdXQ6IFR5cGU8U3V0VHlwZT4gfCBzdHJpbmcsXG4gIHtcbiAgICBkZWNsYXJhdGlvbnMgPSBbXSxcbiAgICBleGNsdWRlQ29tcG9uZW50RGVjbGFyYXRpb24sXG4gICAgd3JhcHBlcixcbiAgfTogUGljazxSZW5kZXJUZW1wbGF0ZU9wdGlvbnM8YW55PiwgJ2RlY2xhcmF0aW9ucycgfCAnZXhjbHVkZUNvbXBvbmVudERlY2xhcmF0aW9uJyB8ICd3cmFwcGVyJz4sXG4pIHtcbiAgaWYgKHR5cGVvZiBzdXQgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIFsuLi5kZWNsYXJhdGlvbnMsIHdyYXBwZXJdO1xuICB9XG5cbiAgY29uc3QgY29tcG9uZW50cyA9ICgpID0+IChleGNsdWRlQ29tcG9uZW50RGVjbGFyYXRpb24gfHwgaXNTdGFuZGFsb25lKHN1dCkgPyBbXSA6IFtzdXRdKTtcbiAgcmV0dXJuIFsuLi5kZWNsYXJhdGlvbnMsIC4uLmNvbXBvbmVudHMoKV07XG59XG5cbmZ1bmN0aW9uIGFkZEF1dG9JbXBvcnRzPFN1dFR5cGU+KFxuICBzdXQ6IFR5cGU8U3V0VHlwZT4gfCBzdHJpbmcsXG4gIHsgaW1wb3J0cyA9IFtdLCByb3V0ZXMgfTogUGljazxSZW5kZXJDb21wb25lbnRPcHRpb25zPGFueT4sICdpbXBvcnRzJyB8ICdyb3V0ZXMnPixcbikge1xuICBjb25zdCBhbmltYXRpb25zID0gKCkgPT4ge1xuICAgIGNvbnN0IGFuaW1hdGlvbklzRGVmaW5lZCA9XG4gICAgICBpbXBvcnRzLmluZGV4T2YoTm9vcEFuaW1hdGlvbnNNb2R1bGUpID4gLTEgfHwgaW1wb3J0cy5pbmRleE9mKEJyb3dzZXJBbmltYXRpb25zTW9kdWxlKSA+IC0xO1xuICAgIHJldHVybiBhbmltYXRpb25Jc0RlZmluZWQgPyBbXSA6IFtOb29wQW5pbWF0aW9uc01vZHVsZV07XG4gIH07XG5cbiAgY29uc3Qgcm91dGluZyA9ICgpID0+IChyb3V0ZXMgPyBbUm91dGVyVGVzdGluZ01vZHVsZS53aXRoUm91dGVzKHJvdXRlcyldIDogW10pO1xuICBjb25zdCBjb21wb25lbnRzID0gKCkgPT4gKHR5cGVvZiBzdXQgIT09ICdzdHJpbmcnICYmIGlzU3RhbmRhbG9uZShzdXQpID8gW3N1dF0gOiBbXSk7XG4gIHJldHVybiBbLi4uaW1wb3J0cywgLi4uY29tcG9uZW50cygpLCAuLi5hbmltYXRpb25zKCksIC4uLnJvdXRpbmcoKV07XG59XG5cbi8qKlxuICogV3JhcCB3YWl0Rm9yIHRvIGludm9rZSB0aGUgQW5ndWxhciBjaGFuZ2UgZGV0ZWN0aW9uIGN5Y2xlIGJlZm9yZSBpbnZva2luZyB0aGUgY2FsbGJhY2tcbiAqL1xuYXN5bmMgZnVuY3Rpb24gd2FpdEZvcldyYXBwZXI8VD4oXG4gIGRldGVjdENoYW5nZXM6ICgpID0+IHZvaWQsXG4gIGNhbGxiYWNrOiAoKSA9PiBUIGV4dGVuZHMgUHJvbWlzZTxhbnk+ID8gbmV2ZXIgOiBULFxuICBvcHRpb25zPzogZHRsV2FpdEZvck9wdGlvbnMsXG4pOiBQcm9taXNlPFQ+IHtcbiAgbGV0IGluRmFrZUFzeW5jID0gdHJ1ZTtcbiAgdHJ5IHtcbiAgICB0aWNrKDApO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBpbkZha2VBc3luYyA9IGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIGF3YWl0IGR0bFdhaXRGb3IoKCkgPT4ge1xuICAgIHNldFRpbWVvdXQoKCkgPT4gZGV0ZWN0Q2hhbmdlcygpLCAwKTtcbiAgICBpZiAoaW5GYWtlQXN5bmMpIHtcbiAgICAgIHRpY2soMCk7XG4gICAgfVxuICAgIHJldHVybiBjYWxsYmFjaygpO1xuICB9LCBvcHRpb25zKTtcbn1cblxuLyoqXG4gKiBXcmFwIHdhaXRGb3JFbGVtZW50VG9CZVJlbW92ZWRXcmFwcGVyIHRvIHBva2UgdGhlIEFuZ3VsYXIgY2hhbmdlIGRldGVjdGlvbiBjeWNsZSBiZWZvcmUgaW52b2tpbmcgdGhlIGNhbGxiYWNrXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHdhaXRGb3JFbGVtZW50VG9CZVJlbW92ZWRXcmFwcGVyPFQ+KFxuICBkZXRlY3RDaGFuZ2VzOiAoKSA9PiB2b2lkLFxuICBjYWxsYmFjazogKCgpID0+IFQpIHwgVCxcbiAgb3B0aW9ucz86IGR0bFdhaXRGb3JPcHRpb25zLFxuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGxldCBjYjogKCkgPT4gVDtcbiAgaWYgKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIGNvbnN0IGVsZW1lbnRzID0gKEFycmF5LmlzQXJyYXkoY2FsbGJhY2spID8gY2FsbGJhY2sgOiBbY2FsbGJhY2tdKSBhcyBFbGVtZW50W107XG4gICAgY29uc3QgZ2V0UmVtYWluaW5nRWxlbWVudHMgPSBlbGVtZW50cy5tYXAoKGVsZW1lbnQpID0+IHtcbiAgICAgIGxldCBwYXJlbnQgPSBlbGVtZW50LnBhcmVudEVsZW1lbnQgYXMgRWxlbWVudDtcbiAgICAgIHdoaWxlIChwYXJlbnQucGFyZW50RWxlbWVudCkge1xuICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50RWxlbWVudDtcbiAgICAgIH1cbiAgICAgIHJldHVybiAoKSA9PiAocGFyZW50LmNvbnRhaW5zKGVsZW1lbnQpID8gZWxlbWVudCA6IG51bGwpO1xuICAgIH0pO1xuICAgIGNiID0gKCkgPT4gZ2V0UmVtYWluaW5nRWxlbWVudHMubWFwKChjKSA9PiBjKCkpLmZpbmQoQm9vbGVhbikgYXMgdW5rbm93biBhcyBUO1xuICB9IGVsc2Uge1xuICAgIGNiID0gY2FsbGJhY2sgYXMgKCkgPT4gVDtcbiAgfVxuXG4gIHJldHVybiBhd2FpdCBkdGxXYWl0Rm9yRWxlbWVudFRvQmVSZW1vdmVkKCgpID0+IHtcbiAgICBjb25zdCByZXN1bHQgPSBjYigpO1xuICAgIGRldGVjdENoYW5nZXMoKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9LCBvcHRpb25zKTtcbn1cblxuZnVuY3Rpb24gY2xlYW51cCgpIHtcbiAgbW91bnRlZEZpeHR1cmVzLmZvckVhY2goY2xlYW51cEF0Rml4dHVyZSk7XG59XG5cbmZ1bmN0aW9uIGNsZWFudXBBdEZpeHR1cmUoZml4dHVyZTogQ29tcG9uZW50Rml4dHVyZTxhbnk+KSB7XG4gIGZpeHR1cmUuZGVzdHJveSgpO1xuXG4gIGlmICghZml4dHVyZS5uYXRpdmVFbGVtZW50LmdldEF0dHJpYnV0ZSgnbmctdmVyc2lvbicpICYmIGZpeHR1cmUubmF0aXZlRWxlbWVudC5wYXJlbnROb2RlID09PSBkb2N1bWVudC5ib2R5KSB7XG4gICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChmaXh0dXJlLm5hdGl2ZUVsZW1lbnQpO1xuICB9IGVsc2UgaWYgKCFmaXh0dXJlLm5hdGl2ZUVsZW1lbnQuZ2V0QXR0cmlidXRlKCdpZCcpICYmIGRvY3VtZW50LmJvZHkuY2hpbGRyZW4/LlswXSA9PT0gZml4dHVyZS5uYXRpdmVFbGVtZW50KSB7XG4gICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChmaXh0dXJlLm5hdGl2ZUVsZW1lbnQpO1xuICB9XG5cbiAgbW91bnRlZEZpeHR1cmVzLmRlbGV0ZShmaXh0dXJlKTtcbn1cblxuLy8gaWYgd2UncmUgcnVubmluZyBpbiBhIHRlc3QgcnVubmVyIHRoYXQgc3VwcG9ydHMgYWZ0ZXJFYWNoXG4vLyB0aGVuIHdlJ2xsIGF1dG9tYXRpY2FsbHkgcnVuIGNsZWFudXAgYWZ0ZXJFYWNoIHRlc3Rcbi8vIHRoaXMgZW5zdXJlcyB0aGF0IHRlc3RzIHJ1biBpbiBpc29sYXRpb24gZnJvbSBlYWNoIG90aGVyXG4vLyBpZiB5b3UgZG9uJ3QgbGlrZSB0aGlzLCBzZXQgdGhlIEFUTF9TS0lQX0FVVE9fQ0xFQU5VUCBlbnYgdmFyaWFibGUgdG8gJ3RydWUnXG5pZiAodHlwZW9mIHByb2Nlc3MgPT09ICd1bmRlZmluZWQnIHx8ICFwcm9jZXNzLmVudj8uQVRMX1NLSVBfQVVUT19DTEVBTlVQKSB7XG4gIGlmICh0eXBlb2YgYWZ0ZXJFYWNoID09PSAnZnVuY3Rpb24nKSB7XG4gICAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICAgIGNsZWFudXAoKTtcbiAgICB9KTtcbiAgfVxufVxuXG5AQ29tcG9uZW50KHsgc2VsZWN0b3I6ICdhdGwtd3JhcHBlci1jb21wb25lbnQnLCB0ZW1wbGF0ZTogJycgfSlcbmNsYXNzIFdyYXBwZXJDb21wb25lbnQge31cblxuLyoqXG4gKiBXcmFwIGZpbmRCeSBxdWVyaWVzIHRvIHBva2UgdGhlIEFuZ3VsYXIgY2hhbmdlIGRldGVjdGlvbiBjeWNsZVxuICovXG5mdW5jdGlvbiByZXBsYWNlRmluZFdpdGhGaW5kQW5kRGV0ZWN0Q2hhbmdlczxUIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgYW55Pj4ob3JpZ2luYWxRdWVyaWVzRm9yQ29udGFpbmVyOiBUKTogVCB7XG4gIHJldHVybiBPYmplY3Qua2V5cyhvcmlnaW5hbFF1ZXJpZXNGb3JDb250YWluZXIpLnJlZHVjZSgobmV3UXVlcmllcywga2V5KSA9PiB7XG4gICAgY29uc3QgZ2V0QnlRdWVyeSA9IG9yaWdpbmFsUXVlcmllc0ZvckNvbnRhaW5lcltrZXkucmVwbGFjZSgnZmluZCcsICdnZXQnKV07XG4gICAgaWYgKGtleS5zdGFydHNXaXRoKCdmaW5kJykgJiYgZ2V0QnlRdWVyeSkge1xuICAgICAgbmV3UXVlcmllc1trZXldID0gYXN5bmMgKC4uLnF1ZXJ5T3B0aW9uczogYW55W10pID0+IHtcbiAgICAgICAgY29uc3Qgd2FpdE9wdGlvbnMgPSBxdWVyeU9wdGlvbnMubGVuZ3RoID09PSAzID8gcXVlcnlPcHRpb25zLnBvcCgpIDogdW5kZWZpbmVkO1xuICAgICAgICAvLyBvcmlnaW5hbCBpbXBsZW1lbnRhdGlvbiBhdCBodHRwczovL2dpdGh1Yi5jb20vdGVzdGluZy1saWJyYXJ5L2RvbS10ZXN0aW5nLWxpYnJhcnkvYmxvYi9tYWluL3NyYy9xdWVyeS1oZWxwZXJzLmpzXG4gICAgICAgIHJldHVybiBhd2FpdCB3YWl0Rm9yV3JhcHBlcihkZXRlY3RDaGFuZ2VzRm9yTW91bnRlZEZpeHR1cmVzLCAoKSA9PiBnZXRCeVF1ZXJ5KC4uLnF1ZXJ5T3B0aW9ucyksIHdhaXRPcHRpb25zKTtcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIG5ld1F1ZXJpZXNba2V5XSA9IG9yaWdpbmFsUXVlcmllc0ZvckNvbnRhaW5lcltrZXldO1xuICAgIH1cblxuICAgIHJldHVybiBuZXdRdWVyaWVzO1xuICB9LCB7fSBhcyBSZWNvcmQ8c3RyaW5nLCBhbnk+KSBhcyBUO1xufVxuXG4vKipcbiAqIENhbGwgZGV0ZWN0Q2hhbmdlcyBmb3IgYWxsIGZpeHR1cmVzXG4gKi9cbmZ1bmN0aW9uIGRldGVjdENoYW5nZXNGb3JNb3VudGVkRml4dHVyZXMoKSB7XG4gIG1vdW50ZWRGaXh0dXJlcy5mb3JFYWNoKChmaXh0dXJlKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgICBpZiAoIWVyci5tZXNzYWdlLnN0YXJ0c1dpdGgoJ1ZpZXdEZXN0cm95ZWRFcnJvcicpKSB7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufVxuXG4vKipcbiAqIFJlLWV4cG9ydCBzY3JlZW4gd2l0aCBwYXRjaGVkIHF1ZXJpZXNcbiAqL1xuY29uc3Qgc2NyZWVuID0gcmVwbGFjZUZpbmRXaXRoRmluZEFuZERldGVjdENoYW5nZXMoZHRsU2NyZWVuKTtcblxuLyoqXG4gKiBSZS1leHBvcnQgd2l0aGluIHdpdGggcGF0Y2hlZCBxdWVyaWVzXG4gKi9cbmNvbnN0IHdpdGhpbiA9IDxRdWVyaWVzVG9CaW5kIGV4dGVuZHMgUXVlcmllcyA9IHR5cGVvZiBkdGxRdWVyaWVzLCBUIGV4dGVuZHMgUXVlcmllc1RvQmluZCA9IFF1ZXJpZXNUb0JpbmQ+KFxuICBlbGVtZW50OiBIVE1MRWxlbWVudCxcbiAgcXVlcmllc1RvQmluZD86IFQsXG4pOiBCb3VuZEZ1bmN0aW9uczxUPiA9PiB7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGR0bFdpdGhpbjxUPihlbGVtZW50LCBxdWVyaWVzVG9CaW5kKTtcbiAgcmV0dXJuIHJlcGxhY2VGaW5kV2l0aEZpbmRBbmREZXRlY3RDaGFuZ2VzKGNvbnRhaW5lcik7XG59O1xuXG4vKipcbiAqIFJlLWV4cG9ydCB3YWl0Rm9yIHdpdGggcGF0Y2hlZCB3YWl0Rm9yXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHdhaXRGb3I8VD4oY2FsbGJhY2s6ICgpID0+IFQgZXh0ZW5kcyBQcm9taXNlPGFueT4gPyBuZXZlciA6IFQsIG9wdGlvbnM/OiBkdGxXYWl0Rm9yT3B0aW9ucyk6IFByb21pc2U8VD4ge1xuICByZXR1cm4gd2FpdEZvcldyYXBwZXIoZGV0ZWN0Q2hhbmdlc0Zvck1vdW50ZWRGaXh0dXJlcywgY2FsbGJhY2ssIG9wdGlvbnMpO1xufVxuXG4vKipcbiAqIFJlLWV4cG9ydCB3YWl0Rm9yRWxlbWVudFRvQmVSZW1vdmVkIHdpdGggcGF0Y2hlZCB3YWl0Rm9yRWxlbWVudFRvQmVSZW1vdmVkXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHdhaXRGb3JFbGVtZW50VG9CZVJlbW92ZWQ8VD4oY2FsbGJhY2s6ICgoKSA9PiBUKSB8IFQsIG9wdGlvbnM/OiBkdGxXYWl0Rm9yT3B0aW9ucyk6IFByb21pc2U8dm9pZD4ge1xuICByZXR1cm4gd2FpdEZvckVsZW1lbnRUb0JlUmVtb3ZlZFdyYXBwZXIoZGV0ZWN0Q2hhbmdlc0Zvck1vdW50ZWRGaXh0dXJlcywgY2FsbGJhY2ssIG9wdGlvbnMpO1xufVxuXG4vKipcbiAqIE1hbnVhbGx5IGV4cG9ydCBvdGhlcndpc2Ugd2UgZ2V0IHRoZSBmb2xsb3dpbmcgZXJyb3Igd2hpbGUgcnVubmluZyBKZXN0IHRlc3RzXG4gKiBUeXBlRXJyb3I6IENhbm5vdCBzZXQgcHJvcGVydHkgZmlyZUV2ZW50IG9mIFtvYmplY3QgT2JqZWN0XSB3aGljaCBoYXMgb25seSBhIGdldHRlclxuICogZXhwb3J0cy5maXJlRXZlbnQgPSBmaXJlRXZlbnRcbiAqL1xuZXhwb3J0IHtcbiAgZmlyZUV2ZW50LFxuICBidWlsZFF1ZXJpZXMsXG4gIGdldEJ5TGFiZWxUZXh0LFxuICBnZXRBbGxCeUxhYmVsVGV4dCxcbiAgcXVlcnlCeUxhYmVsVGV4dCxcbiAgcXVlcnlBbGxCeUxhYmVsVGV4dCxcbiAgZmluZEJ5TGFiZWxUZXh0LFxuICBmaW5kQWxsQnlMYWJlbFRleHQsXG4gIGdldEJ5UGxhY2Vob2xkZXJUZXh0LFxuICBnZXRBbGxCeVBsYWNlaG9sZGVyVGV4dCxcbiAgcXVlcnlCeVBsYWNlaG9sZGVyVGV4dCxcbiAgcXVlcnlBbGxCeVBsYWNlaG9sZGVyVGV4dCxcbiAgZmluZEJ5UGxhY2Vob2xkZXJUZXh0LFxuICBmaW5kQWxsQnlQbGFjZWhvbGRlclRleHQsXG4gIGdldEJ5VGV4dCxcbiAgZ2V0QWxsQnlUZXh0LFxuICBxdWVyeUJ5VGV4dCxcbiAgcXVlcnlBbGxCeVRleHQsXG4gIGZpbmRCeVRleHQsXG4gIGZpbmRBbGxCeVRleHQsXG4gIGdldEJ5QWx0VGV4dCxcbiAgZ2V0QWxsQnlBbHRUZXh0LFxuICBxdWVyeUJ5QWx0VGV4dCxcbiAgcXVlcnlBbGxCeUFsdFRleHQsXG4gIGZpbmRCeUFsdFRleHQsXG4gIGZpbmRBbGxCeUFsdFRleHQsXG4gIGdldEJ5VGl0bGUsXG4gIGdldEFsbEJ5VGl0bGUsXG4gIHF1ZXJ5QnlUaXRsZSxcbiAgcXVlcnlBbGxCeVRpdGxlLFxuICBmaW5kQnlUaXRsZSxcbiAgZmluZEFsbEJ5VGl0bGUsXG4gIGdldEJ5RGlzcGxheVZhbHVlLFxuICBnZXRBbGxCeURpc3BsYXlWYWx1ZSxcbiAgcXVlcnlCeURpc3BsYXlWYWx1ZSxcbiAgcXVlcnlBbGxCeURpc3BsYXlWYWx1ZSxcbiAgZmluZEJ5RGlzcGxheVZhbHVlLFxuICBmaW5kQWxsQnlEaXNwbGF5VmFsdWUsXG4gIGdldEJ5Um9sZSxcbiAgZ2V0QWxsQnlSb2xlLFxuICBxdWVyeUJ5Um9sZSxcbiAgcXVlcnlBbGxCeVJvbGUsXG4gIGZpbmRCeVJvbGUsXG4gIGZpbmRBbGxCeVJvbGUsXG4gIGdldEJ5VGVzdElkLFxuICBnZXRBbGxCeVRlc3RJZCxcbiAgcXVlcnlCeVRlc3RJZCxcbiAgcXVlcnlBbGxCeVRlc3RJZCxcbiAgZmluZEJ5VGVzdElkLFxuICBmaW5kQWxsQnlUZXN0SWQsXG4gIGNyZWF0ZUV2ZW50LFxuICBnZXREZWZhdWx0Tm9ybWFsaXplcixcbiAgZ2V0RWxlbWVudEVycm9yLFxuICBnZXROb2RlVGV4dCxcbiAgZ2V0UXVlcmllc0ZvckVsZW1lbnQsXG4gIGdldFJvbGVzLFxuICBpc0luYWNjZXNzaWJsZSxcbiAgbG9nRE9NLFxuICBsb2dSb2xlcyxcbiAgcHJldHR5RE9NLFxuICBxdWVyaWVzLFxuICBxdWVyeUFsbEJ5QXR0cmlidXRlLFxuICBxdWVyeUJ5QXR0cmlidXRlLFxuICBxdWVyeUhlbHBlcnMsXG59IGZyb20gJ0B0ZXN0aW5nLWxpYnJhcnkvZG9tJztcblxuLy8gZXhwb3J0IHBhdGNoZWQgZHRsXG5leHBvcnQgeyBzY3JlZW4sIHdhaXRGb3IsIHdhaXRGb3JFbGVtZW50VG9CZVJlbW92ZWQsIHdpdGhpbiB9O1xuIl19